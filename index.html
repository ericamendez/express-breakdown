<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
  </link>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/a11y-dark.min.css"> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
</head>

<body>
  <header>
    <h1>How Node runs server.js in 21 Savage Demo</h1>
  </header>
  <main>
    <section class="leftContainer">
      <ul class="navigation">
        <li><a href="#"><span></span></a></li>
        <li><a href="#"><span></span></a></li>
      </ul>
      <section class="arrowContainer">
        <a id="prev" class="arrow"></a>
        <div class="zebra">
          <a id="next" class="arrow"></a>ÃŸ
        </div>
      </section>
      <section class="content">
        <ul id="pages">
          <li>
            <h3>Step 1</h3>
            <p>Before we run line by line, all global variables (var, let, const) and function declarations get stored
              in global memory (just declarations not initilization)
            </p>
            <p>
              Now Javascript knows those variables exist in global memory.
            </p>
          </li>
        </ul>
      </section>

    </section>

    <section class="rightContainer">
      <pre>
        <code class="javascript">
          <span id="line1">const express = require('express')</span>
          <span id="line2">const app = express()</span>
          <span id="line3">const bodyParser = require('body-parser')</span>
          <span id="line4">const MongoClient = require('mongodb').MongoClient</span>
          
          <span id="line5">var db, collection;</span>
          
          <span id="line6">const url = "mongodb+srv://demo:demo@cluster0-q2ojb.mongodb.net/test?retryWrites=true";</span>
          <span id="line7">const dbName = "demo";</span>
          
          <span id="line8">app.listen(3000, () => {</span>
              <span id="line9"><span id="line34">MongoClient.connect(url, { useNewUrlParser: true, useUnifiedTopology: true }, (error, client) => {</span></span>
                  <span id="line10">if(error) {</span>
                      <span id="line11">throw error;</span>
                  <span id="line12">}</span>
                  <span id="line13">db = client.db(dbName);</span>
                  <span id="line14">console.log("Connected to `" + dbName + "`!");</span>
                <span id="line15">});</span>
              <span id="line16">console.log("Listening on port 3000")</span>
          <span id="line17">});</span>
          
          app.set('view engine', 'ejs')
          app.use(bodyParser.urlencoded({extended: true}))
          app.use(bodyParser.json())
          app.use(express.static('public'))
  
          app.get('/', (req, res) => {
            db.collection('messages').find().toArray((err, result) => {
              if (err) return console.log(err)
              res.render('index.ejs', {messages: result})
            })
          })
          
          app.post('/messages', (req, res) => {
            db.collection('messages').insertOne({name: req.body.name, msg: req.body.msg, thumbUp: 0, thumbDown:0}, (err, result) => {
              if (err) return console.log(err)
              console.log('saved to database')
              res.redirect('/')
            })
          })
          
          app.put('/messages', (req, res) => {
            db.collection('messages').findOneAndUpdate({name: req.body.name, msg: req.body.msg}, {
              $set: {
                thumbUp:req.body.thumbUp + 1
              }
            }, {
              sort: {_id: -1},
              upsert: true
            }, (err, result) => {
              if (err) return res.send(err)
              res.send(result)
            })
          })
          
          app.delete('/messages', (req, res) => {
            db.collection('messages').findOneAndDelete({name: req.body.name, msg: req.body.msg}, (err, result) => {
              if (err) return res.send(500, err)
              res.send('Message deleted!')
            })
          })
          
        </code>
      </pre>
    </section>
  </main>

  <!-- https://codepen.io/silverdrop/pen/rNNmZJ -->

  <script src="js/script.js" type="text/javascript"></script>
</body>

</html>